<!DOCTYPE html>
<html lang="en_us" xml:lang="en_us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Conectados</title>
        <link rel="icon" href="img/logo.ico">
        <link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="js/bootstrap.js"></script>
		<script src="js/bootstrap.min.js"></script>
        <style type="text/css" media="screen">
            body{
                background: url(img/fondo1.jpg) no-repeat center center fixed;
                -webkit-background-size: cover;
                -moz-background-size: cover;
                -o-background-size: cover;
                background-size: cover;
                height: 100%;
            }
            .log::placeholder { 
                font-weight: bold; 
            }
        </style>
    </head>
    <body>
    	<div class="container">
    		<div class="row" style="margin-left: 5; margin-right: 5">
                <div class="col-md12" style="padding: 5px">
                    <div class="dropdown">
                        <button class="btn btn-default dropdown-toggle" id="menu1" type="button" data-toggle="dropdown" style=" margin: 0; outline: none; background-color: #FDFEFE; float: left;border-radius: 0 10px 10px 0; padding: 10px 9px 10px 7px">
                            <span class="glyphicon glyphicon-th-list" style="color: #6b6b6b; font-size: 30px; margin: 0; padding: 0;"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="menu1" style="margin-top: 60px;background: linear-gradient(45deg, #ecee1b, #5faf26)">
                            <li role="presentation" style="border-bottom: 1px solid #FDFEFE;padding: 5px">
                                <a role="menuitem" tabindex="-1" href="app.html" style="color: #FDFEFE">Inicio</a>
                            </li>
                            <li role="presentation" style="border-bottom: 1px solid #FDFEFE;padding: 5px">
                                <a role="menuitem" tabindex="-1" href="cambiar_pwd.html" style="color: #FDFEFE">Cambiar contraseña</a>
                            </li>
                            <li role="presentation" style="border-bottom: 1px solid #FDFEFE;padding: 5px">
                                <a role="menuitem" tabindex="-1" href="buscar.html" style="color: #FDFEFE">Buscar por cédula</a>
                            </li>
                            <li role="presentation" style="border-bottom: 1px solid #FDFEFE;padding: 5px">
                                <a role="menuitem" tabindex="-1" href="editar.html" style="color: #FDFEFE">Editar registro</a>
                            </li>
                            <li role="presentation" style="border-bottom: 1px solid #FDFEFE;padding: 5px">
                                <a role="menuitem" tabindex="-1" href="mis_registros.html" style="color: #FDFEFE">Mis registros</a>
                            </li>    
                            <li role="presentation" style="padding: 4px">
                                <a role="menuitem" tabindex="-1" href="salir.html" style="color: #FDFEFE">Salir</a>
                            </li>    
                        </ul>
                      </div>
                    </div>
                    <button type="button" class="btn pull-right" style="border-radius: 50px; border:0; margin: 0; padding: 0; outline: none; background-color: transparent;">
                        <a href="ayuda.html" title="AYUDA">
                           <span class="glyphicon glyphicon-exclamation-sign" style="color: #FDFEFE; font-size: 35px; margin: 0; padding: 0;"></span>
                        </a>
                    </button>
                </div>
    		</div>
    		<div class="row" style="margin: 0">
    			<div class="col-md12">
    				<form id="buscar_refe" style="padding-top: 20px">
    					<legend class="text-center header" style="padding-top: 0; padding-bottom: 10px;margin: 0; border: 0; color: #FDFEFE; font-size: 25px">
                            <b>Buscar por cédula</b>
                        </legend>
    					<div class="form-group center-block" style="width: 90%; ">
                            <input type="number" class="form-control log" id="documento" placeholder="Cédula" style="border-radius: 45px">
						</div>
                        <div class="form-group text-center" style="padding-top: 10px">
                            <a href="#" title="">
                                <button type="submit" class="btn btn-primary btn-lg" style=" border-radius: 45px;background: linear-gradient(to left, #ecee1b,#5faf26);">BUSCAR</button>
                            </a>
                        </div>
    				</form>
                    <form  id="referido" style="padding-top: 10px; visibility: hidden;">
                        <div class="form-group center-block" style="width: 90%; ">
                            <label style="columns: 1">
                                <input type="number" class="form-control" id="id_documento" placeholder="Documento" style="border-radius: 45px">
                            </label>
                        </div>
                        <div class="form-group center-block" style="width: 90%; ">
                            <label style="columns: 2">
                                <input type="text" class="form-control" id="nombre1" placeholder="1° Nombre" style="border-radius: 45px">
                                <input type="text" class="form-control" id="nombre2" placeholder="2° Nombre" style="border-radius: 45px">
                            </label>
                        </div>
                        <div class="form-group center-block" style="width: 90%; ">
                            <label style="columns: 2">
                                <input type="text" class="form-control" id="apellido1" placeholder="1° Apellido" style="border-radius: 45px">
                                <input type="text" class="form-control" id="apellido2" placeholder="2° Apellido" style="border-radius: 45px">
                            </label>
                        </div>
                        <div class="form-group center-block" style="width: 90%; ">
                            <label style="columns: 2">
                                <input type="text" class="form-control" id="fec_nacimi" placeholder="fecha de nacimiento" style="border-radius: 45px">
                                <input type="text" class="form-control" id="tipo_sang" placeholder="Tipo de sangre" style="border-radius: 45px">
                            </label>
                        </div>
                        <div class="form-group center-block" style="width: 90%; ">
                            <label style="columns: 2">
                                <input type="number" class="form-control" id="tel_movil" placeholder="Celular" style="border-radius: 45px">
                                <input type="email" class="form-control" id="val_correo" placeholder="Correo" style="border-radius: 45px">
                            </label>
                        </div>
                        <div class="form-group center-block" style="width: 90%; padding-bottom: 13px">
                            <label style="columns: 2">
                                <input type="text" class="form-control" id="direccion" placeholder="Dirección" style="border-radius: 45px">
                                <input type="text" class="form-control" id="municipio" placeholder="Municipio" style="border-radius: 45px">
                            </label>
                        </div>
                    </form>
                    <p id="demo"></p>
    			</div>
    		</div>
            <br>
    	</div>	
        <script type="text/javascript" src="cordova.js"></script>
        <script>
            $(document).ready(function(){
                var session = localStorage.getItem('mi_session');
                if (session==null) {
                    alert("Por favor inicie sesion")
                    localStorage.removeItem("mi_session");
                    window.location.href =("login.html");
                }
                
                $(".dropdown-toggle").dropdown();
            });
            $('#buscar_refe').submit(function() { 
                // recolecta los valores que inserto el usuario
                var datosDocumento  = $("#documento").val()
                var usuario         = localStorage.getItem('mi_session');
                var documento
                var nombre1
                var nombre2
                var apellido1
                var apellido2
                var nacimiento
                var tipo_sang
                var ceular
                var correo
                var direccion
                var municipio
                
                archivoValidacion = "http://manuelguillermo.com/webservices/buscar.php?jsoncallback=?"
                $.getJSON( archivoValidacion, { documento:datosDocumento, usuario:usuario}).done(function(respuestaServer) {

                    if(respuestaServer.length === 0){
                        /// si la validacion es correcta, muestra la pantalla "home"
                        alert("El referido no existe")
                        document.getElementById("referido").style.visibility="hidden"
                        //window.location.href =("buscar.html");
                        
                    }else{
                        /// ejecutar una conducta cuando la validacion falla
                        documento = respuestaServer[0].id_documento
                        nombre1 = respuestaServer[0].nombre1
                        nombre2 = respuestaServer[0].nombre2
                        apellido1 = respuestaServer[0].apellido1
                        apellido2 = respuestaServer[0].apellido2
                        nacimiento = respuestaServer[0].fecnac
                        tipo_sang = respuestaServer[0].tipo_sang
                        celular = respuestaServer[0].tel_movil
                        correo = respuestaServer[0].correo
                        direccion = respuestaServer[0].direccion_res
                        municipio = respuestaServer[0].municipio_res

                        alert("Referido encontrado= " + respuestaServer[0].id_documento)


                        document.getElementById("referido").style.visibility="visible"
                        document.getElementById("id_documento").value = documento;
                        document.getElementById("nombre1").value = nombre1;
                        document.getElementById("nombre2").value = nombre2;
                        document.getElementById("apellido1").value = apellido1;
                        document.getElementById("apellido2").value = apellido2;
                        document.getElementById("fec_nacimi").value = nacimiento;
                        document.getElementById("tipo_sang").value = tipo_sang;
                        document.getElementById("tel_movil").value = celular;
                        document.getElementById("val_correo").value = correo;
                        document.getElementById("direccion").value = direccion;
                        document.getElementById("municipio").value = municipio;
                    }
                })
                return false;
            })
        </script>
    </body>
</html>
